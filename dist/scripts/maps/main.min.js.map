{"version":3,"sources":["main.js"],"names":["_checkEnvironment","$","method","mobileType","content","stringify","userAgent","uid","urlHandle","getParameter","window","webkit","messageHandlers","showSharePop","bookCode","res","test","parse","WebView","isInApp","style","timeout","checkEnvironment","ellaH5API","downloadLink","modalContent","modalNotice","api","document","display","onclick","open","ellaH5","options","width","left","top","transform","padding","webkitTransform","backgroundColor","borderRadius","maskStyle","zIndex","textAlign","confirmText","confirmStyle","height","lineHeight","post","JSON","status","alert","message","color","data","doms","totalList","titles","index","length","weekData","bookList","winterVacationBooksDto","normalBookList","book","result","bookCoverUrl","bookName","bookIntroduction","subscribeStatus","slice","forEach","navigator","planTitle","substr","createWeeks","err","innerHTML","btns","querySelectorAll","e","that","this","getElementById","dataset","code","classList","contains","add","init","remove"],"mappings":"cAAA,WAAa,IAAAA,EAmMGC,WACEC,IAAAA,EAAAA,EADUC,EAEVC,0BAAcC,KAAAA,UAAUC,YACtBC,OAAAA,QAAKC,OAAUC,OAAAA,iBADOC,OAAAC,OAAAC,gBAAAC,eAEtBC,GAAAA,GAED,UACDC,aAAUC,KAACC,UAAXX,YApDNI,OAAOQ,SAAaR,OAAOQ,QAAQL,eAqD7BM,GAAA,GAEIC,YAAOD,GAAA,EACPE,SAMNX,OAHCA,OAAAS,QAdDA,EAgBDT,OAAAP,WAAMA,EACLO,CACDS,UACDA,EAnDRhB,WAAAA,GAjKJmB,GAAAH,EAFWnB,EAEXmB,QACehB,GAHJH,EAEXG,WACeA,OAHJoB,WAAA,6CAOPC,EAAe,yDACMC,EAAe,yBAA0BC,EAAc,GAF5EC,IACJF,EAAgB,oBAChBC,EAAc,gBAAdE,SAAyBH,cAAe,WAAAL,MAAAS,QAAxC,QAAAD,SAAkEF,cAAlE,WAAAI,QAAA,WAMIpB,OAAOqB,KAAKP,KAKhBd,OAAOsB,OAAOC,QAAU,CANtBL,GAAAA,WACElB,MAAAA,CADFwB,MAAA,MAKFC,KAAA,MAMIC,IAAK,MACLC,UAAW,iBANf3B,gBAAA,iBACI4B,QAAE,KACJlB,gBAAO,UACLc,aADK,WAGLE,UAAK,CACLC,OAAAA,IACAE,gBAAiB,mBAEjBC,YAAAA,KACAC,aAAY,CAVQZ,QAAA,QAYtBa,MAAS,UACPC,OAAQ,QACRH,WAAAA,UAdoBI,UAAA,SAgBtBC,WAAa,QACbC,aAAc,SACZjB,OAAO,eACPK,MAAO,OACPa,SAAQ,UAERH,WAAS,CACTI,QAAAA,SA2LJ/C,EAAEgD,KAAKtB,EAAK,CACVzB,OAAQ,uCACRE,QAAS8C,KAAK7C,UAAU,CACtBE,IAAKC,UAAUC,aAAa,UAE7B,SAAUM,GAEQ,OADnBA,EAAMmC,KAAKjC,MAAMF,IACToC,OACNzC,OAAOsB,OAAOoB,MAAMrC,EAAIsC,QAAS,CAC/BjC,MAAO,CAAEkC,MAAO,QAChBjC,QAAS,SArBJ,SAAAkC,GAIN,IAAAC,EA1LW,SAjBQC,GAuDtB,IAzBE5B,IAAAA,EAAS,GAIb6B,EAAA,CAAA,mEAAA,yEAAA,kEAAA,8DAAA,6DAqBWC,EAAQ,EAAGA,EAAQF,EAAUG,OAAQD,IAAS,CACrD,IAAME,EAAWJ,EAAUE,GAWvBA,EAAK,GACPvD,EAAW0D,GARiBA,EAAaD,EAArCE,uBAA+CC,EAAiBF,EA2BpE1D,GAAAA,IAAOqD,EAAAG,OAAA,EAAA,CADT,IAaAK,EAAAH,EAAA,GACAI,EAAAA,wGAAAA,OA5BgED,EAAKE,aA4BrED,oMAAAA,OAxBoCD,EAAKG,SAwBzCF,oDAAAA,OAuBwBD,EAAAI,iBAvBxBH,iDAAAA,OAwBF,QAAAD,EAAAK,gBAAA,UAAA,GAxBEJ,iBAAAA,OAwBFD,EAAAnD,SAxBEoD,kEA2BE/C,EAAA6C,EAAAO,MAAA,GAFJP,EAKWQ,QAAaxD,SAAAA,EAAKyD,EAAUnE,GACrCF,GAAMM,mCAAAA,OACJ,IAAAiD,EAAA,qBAAA,GADIjD,sEAAAA,OAELuD,EAAAE,aAFKzD,+GAAAA,OAGN,QAAAuD,EAAAK,gBAAA,UAAA,GAHM5D,iBAAAA,OAGNuD,EAAAnD,SAHMJ,4FAAAA,OAMNuD,EAAAG,SANM1D,4CAYNS,GAAAA,oCAAAA,OACAhB,EADAgB,wGAAAA,OAvCkB0C,EAASa,UAAUC,OAAO,GAuC5CxD,6BAAAA,OAtCYuC,EAAOC,GAsCnBxC,0CAAAA,OAOFiB,EAPEjB,gQAAAA,OAeSwC,EAfTxC,sDAqBI,OAAA+C,EAuCHU,CAAArB,GACF3B,SAAQiD,eAAK,SAAAC,UAAAtB,EAEb,IAAAuB,EAAAnD,SAAAoD,iBAAA,aAjDD,IAqDA/B,IAAKtB,IAAKgC,EAAA,EAAAA,EAAAoB,EAAAnB,OAAAD,IACFoB,EAAApB,GACD7B,QAAOzB,SAAU4E,GAAf,IAAAC,EAAAC,KAIC9B,EAAOtC,uFAAAA,OAnOF,OAmOEA,2CAAAA,OAGNU,EAHMV,0CAAAA,OAGGW,EAHHX,wCACjBL,OAKOsB,OAAAoB,MAAAC,EAAA,CACAtC,UAAL,WACSqE,EACAA,EAAAA,KAAAA,EAAAA,CACVlF,OAAA,+BAhBHE,QAAA8C,KAAA7C,UAAA,CArOFE,IAAAC,UAAAC,aAAA,OAuMoBK,SAAUoE,EAAKG,QAAQC,QAExB,SAAUvE,GAEQ,OADnBA,EAAMmC,KAAKjC,MAAMF,IACToC,QACNzC,OAAOsB,OAAOoB,MAAMrC,EAAIsC,QAAS,CAC/BjC,MAAO,CAAEkC,MAAO,QAChBjC,QAAS,SAMfX,OAAOqB,KAAKP,GAGT0D,EAAKK,UAAUC,SAAS,YAC3BN,EAAKK,UAAUE,IAAI,eAO7B,MAAOZ,GACPzB,MAAMyB,IAkBNa,CAAK3E,EAAIwC,MACT3B,SAASwD,eAAe,WAAWhE,MAAMS,QAAU,OACnDD,SAASwD,eAAe,WAAWO,YApPzC","file":"../main.min.js","sourcesContent":["(function () {\n\n  // 检测设备类型\n  let { isInApp, mobileType } = checkEnvironment();\n\n  // 项目配置.\n  let api = window.ellaH5API || 'http://qaapi.ellabook.cn/rest/api/service';\n  let downloadLink = 'https://a.app.qq.com/o/simple.jsp?pkgname=com.ellabook';\n  let modalTitle = \"订阅成功\", modalContent = \"感谢喜欢这本书，绘本上线当天会通知您来看哦！\", modalNotice = \"\";\n  if (!isInApp) {\n    modalContent = \"下载咿啦看书APP查看完整绘本书单\";\n    modalNotice = \"新用户免费赠送绘本大礼包哦\";\n    document.querySelector('.weixin').style.display = 'block';\n    document.querySelector('.weixin').onclick = function () {\n      window.open(downloadLink);\n    }\n  }\n\n  // // 弹窗属性配置\n  window.ellaH5.options = {\n    id: 'AlertBox',\n    style: {\n      width: '70%',\n      left: '10%',\n      top: '35%',\n      transform: 'translate(0,0)',\n      webkitTransform: 'translate(0,0)',\n      padding: '5%',\n      backgroundColor: '#ffffff',\n      borderRadius: '0.21rem'\n    },\n    maskStyle: {\n      zIndex: 1000,\n      backgroundColor: 'rgba(0,0,0,0.5)'\n    },\n    confirmText: \"好的\",\n    confirmStyle: {\n      display: 'block',\n      width: '1.56rem',\n      height: '.6rem',\n      background: '#5baaf3',\n      textAlign: 'center',\n      lineHeight: '.6rem',\n      borderRadius: '.32rem',\n      margin: '.3rem auto 0',\n      color: '#fff',\n      fontSize: '.26rem'\n    },\n    closeStyle: {\n      display: 'none'\n    }\n  }\n\n  // 声明：创建页面方法\n  function createWeeks(totalList) {\n\n    let result = '';\n    let titles = [\n      `<span>放假啦~~让宝宝在假期开始时</span>\n      <span>放松身心，准备迎接美好的寒假生活</span>`,\n\n      `<span>马上就要过年啦~~我们又长大了一岁</span>\n      <span>多学些人文知识，在假期增长宝宝的眼界！</span>`,\n\n      `<span>过年啦~~大家春节快乐</span>\n      <span>带宝宝一起来了解中国传统的过年习俗吧</span>`,\n\n      `<span>假期接近尾声了，别难过</span>\n      <span>打开绘本，继续奇妙的梦幻之旅</span>`,\n\n      `<span>开学恐惧症？不怕</span>\n      <span>每天一部动画书，给你假期好心情</span>`\n    ]\n\n    for (let index = 0; index < totalList.length; index++) {\n      const weekData = totalList[index];\n\n      let top = '';\n      let content = '';\n      let { winterVacationBooksDto: bookList } = weekData, normalBookList = bookList;\n\n      /**\n       * 区分最后一周\n       * 如果不是最后一周，则是top(1)+content(6)的结构\n       * 如果是最后一周，则是cotent(3)的结构\n       */\n      if (index !== totalList.length - 1) {\n        let book = bookList[0];\n        // 创建 推荐图书\n        top = `\n            <div class=\"top\">\n              <div class=\"book-cover\" style=\"background:#39b3f3 url(${book.bookCoverUrl}) center no-repeat;background-size:cover;\">\n                <div class=\"hot\">推荐</div>\n              </div>\n              <div class=\"book-content\">\n                <div class=\"book-name\">《${book.bookName}》</div>\n                <div class=\"book-desc\">${book.bookIntroduction}</div>\n                <div class=\"book-btn ${book.subscribeStatus === 'YES' ? 'checked' : ''}\" data-code=\"${book.bookCode}\"></div>\n              </div>\n            </div>\n          `;\n        normalBookList = normalBookList.slice(1);\n      }\n\n      // 创建图书列表\n      normalBookList.forEach((book, index, bookLish) => {\n        content += `\n            <div class=\"book\" ${index === 3 ? 'style=\"clear:both\"' : ''}>\n              <div class=\"cover\" style=\"background:#39b3f3 url(${book.bookCoverUrl}) center no-repeat;background-size:cover;\">\n                <div>\n                  <div class=\"book-btn ${book.subscribeStatus === 'YES' ? 'checked' : ''}\" data-code=\"${book.bookCode}\"></div>\n                </div>\n              </div>\n              <div class=\"name\">${book.bookName}</div>\n            </div>\n          `;\n      })\n\n      // 生成weeks代码串\n      result += `\n          <div class=\"week week${index}\">\n              <div class=\"tag\"></div>\n              <div class=\"title\">\n                <span>${weekData.planTitle.substr(5)}</span>\n                ${titles[index]}\n              </div>\n              ${top}\n              <div class=\"divide\">\n                <div class=\"left round\"></div>\n                <div class=\"line\"></div>\n                <div class=\"right round\"></div>\n              </div>\n              <div class=\"content\">\n                ${content}\n              </div>\n          </div>\n        `;\n    }\n    return result;\n  }\n\n  // 声明：设备类型检测\n  function checkEnvironment() {\n    let isInApp, mobileType;\n    if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) {\n      if (!!window.webkit && !!window.webkit.messageHandlers && !!window.webkit.messageHandlers.showSharePop) {\n        isInApp = true;\n      }\n      mobileType = \"iPhone\";\n    } else if (/(Android)/i.test(navigator.userAgent)) {\n      if (!!window.WebView && !!window.WebView.showSharePop) {\n        isInApp = true;\n      }\n      mobileType = \"Android\";\n    } else {\n      isInApp = false;\n      mobileType = \"other\";\n    }\n\n    window.isInApp = isInApp;\n    window.mobileType = mobileType;\n    return {\n      isInApp: !!isInApp,\n      mobileType\n    }\n  }\n\n  // 声明调用：主函数,根据服务端数据，创建页面\n  function init(data) {\n    // 调用：创建页面方法\n\n    let doms = createWeeks(data);\n    document.getElementById('Weeks').innerHTML = doms;\n    // 绑定点击事件\n    let btns = document.querySelectorAll('.book-btn');\n\n    try {\n      for (var index = 0; index < btns.length; index++) {\n        var btn = btns[index];\n        btn.onclick = function (e) {\n\n          let that = this;\n\n          let message = `\n          <div class=\"mail\"></div>\n          <div>\n          <div class=\"title\">${modalTitle}</div>\n          <div class=\"content\">${modalContent}</div>\n          <div class=\"notice\">${modalNotice}</div>\n          </div>\n          `;\n\n          window.ellaH5.alert(message, {\n            onConfirm: function () {\n              if (isInApp) {\n                $.post(api, {\n                  method: 'ella.activity.subscribeBooks',\n                  content: JSON.stringify({\n                    uid: urlHandle.getParameter('uid'),\n                    bookCode: that.dataset.code\n                  })\n                }, function (res) {\n                  res = JSON.parse(res);\n                  if (res.status !== \"1\") {\n                    window.ellaH5.alert(res.message, {\n                      style: { color: '#fff' },\n                      timeout: 1500\n                    })\n                  }\n                })\n\n              } else {\n                window.open(downloadLink)\n              }\n              // 按钮状态\n              if (!that.classList.contains('checked')) {\n                that.classList.add('checked')\n              }\n            }\n          });\n\n        }\n      }\n    } catch (err) {\n      alert(err)\n    }\n\n  }\n\n  $.post(api, {\n    method: 'ella.activity.getWinterVacationBooks',\n    content: JSON.stringify({\n      uid: urlHandle.getParameter('uid')\n    })\n  }, function (res) {\n    res = JSON.parse(res);\n    if (res.status === \"0\") {\n      window.ellaH5.alert(res.message, {\n        style: { color: '#fff' },\n        timeout: 1500\n      })\n    } else {\n      init(res.data);\n      document.getElementById('Loading').style.display = 'none';\n      document.getElementById('Loading').remove();\n    }\n  })\n\n})()"]}