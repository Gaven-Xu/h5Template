{"version":3,"sources":["main.js"],"names":["api","window","ellaBookH5IP","exchangeCode","thirdCode","$","post","res","JSON","content","stringify","uid","ellaH5","getQuery","timeout","parse","status","init","alert","message","document","getElementById","data","result","initVipData","isInApp","members","item","index","concat","thirdType","activeTime","points","pointsBalance","title","price","userInfo","userAvatar","webkit","userNick","vipLeftDays","before","doms","on","css","display","log","this","split","arr","html","method","arr2","channelCode","setTimeout","location","token","reload","style","remove"],"mappings":"cAAA,WAEE,IAAAA,EAAAC,OAAAC,aAAAD,OAAAC,aAAA,oBAAA,8CAEIF,EAAaE,GACbC,EAAY,GACZC,EAAY,GAmJJC,EAAZC,KAQGN,EAAA,CACDO,OAAMC,gCAPNC,QAASD,KAAKE,UAAU,CAQxBC,IAAOC,OAAHC,SAAJ,UAGIC,SAAOP,GAEJ,OAJ4BA,EAAjCC,KAAAO,MAAAR,IAIKS,OACLC,OAAKV,OAALW,MAAAX,EAAAY,QAAA,CACAC,MAASC,CAAAA,MAAAA,QACTD,QAASC,QAlEThB,SAAEiB,GAGFlB,IAAAA,EA7FJ,SAAqBkB,GAArB,IAAAC,EAASC,GACHD,EAAS,GAqDXE,OApDFH,EAAII,KAAAA,QAAJ,SAAAC,EAAAC,GACAN,GAAA,mDAAAO,OACSF,EAAAxB,aAAA,IAAAwB,EACmCA,UAAKxB,IAAewB,EAApBG,UAF5C,eAAAD,OAE4CF,EAAqDI,WADxF,IAAAJ,EAAAK,OAAA,IACqHD,EAAAA,SAAaE,cAF3I,0DAAAJ,OAaMF,EAAAO,MAbN,kCAAAL,OA8BAF,EAAAQ,MA9BA,kEAAAN,OAiCFF,EAAAK,OAjCE,yCAaAT,GAAM,sDAAAM,OAGWP,EAAKc,SAASC,WAAaf,EAAKc,SAASC,WAAa,wBAHjE,qDAAAR,OA4BE5B,EAAOqC,SAAUC,SA5BnB,kCAAAV,OA6BFP,EAAAc,SAAAI,YA7BE,6JAAAX,OAkCFJ,EAlCE,oCA6EKD,CAATF,GACAQ,EAAAA,oBAAAW,OAAAC,GAGFrC,EAAA,eAAAsC,GAAA,QAAA,WAnBEtC,EAAE,gBAAgBuC,IAAI,CAAEC,QAAS,UAoBjCxC,EAAA,UAAFuC,IAAe,CAAAC,QAAS,UACtBxC,QAAEyC,IAAAzC,EAAA0C,MAAgBH,KAAI,SAAEC,IAAAA,EAAOxC,EAAE0C,MAAAzB,KAAA,QAAA0B,MAAA,KAC/BjB,EAAckB,EAAA,GAAEJ,EAASI,EAAA,GAA3BhB,EAAAgB,EAAA,GAZA5C,EAAE,cAAc6C,KAAKjB,GAerB5B,EAAA,eAAY6C,KAASnB,GACrB1B,EAAEC,WAAU4C,KAAAlB,GACVmB,IAAAA,EAAQ9C,EAAA0C,MAAAzB,KAAA,UAAA0B,MADE,KAEVvC,EAAa2C,EAAC1C,GAEZN,EAAAgD,EAAA,GACAtB,EAAAsB,EAAA,KAHsB/C,EAAA,UAFdsC,GAAA,QAAA,WAUVhC,EAAAA,gBAAYE,IAAP,CAAgBgC,QAVX,SAWVQ,EAAAA,UAAAA,IAAa,CAAAR,QAXH,WAcVtC,EAAAA,SAAMC,GAAI,QAAOD,WAdnBF,EAAEC,KAAKN,EAAK,CAeVmD,OAAQnC,4BACNX,QAAEG,KAAUoC,UAAI,CAEhBU,aAAAA,EACEjD,UAAAA,EAAkByB,UAAAA,IAClByB,IAAAA,OAAQ1C,SAAQ,OACjBwC,YAHD,KAIDG,MAAM,SACLnD,SAAEE,GAAF,OAAkBA,EAAAC,KAAAO,MAAWR,IAA7BS,QACAX,EAAE,UAAU6C,IAAZ,CAAiB3C,QAAjB,UACA+C,EAAAA,UAAWJ,KAAA,SACT7C,WAAE,WAAgBA,EAAA,UAAAuC,IAAW,CAAAC,QAAA,SAAbU,SAAhBE,QAAA,IAEC,OA5BPpD,EAAA,UAAAuC,IAAA,CAAAC,QAAA,UADFxC,EAAA,UAAA6C,KAAA3C,EAAAY,SAkCDmC,WAAA,WAPSjD,EAAE,UAAUuC,IAAI,CAAEC,QAAW,UAS7B,UA1JZ5B,CAAAV,EAAAe,MA0KMF,SAASC,eAAe,WAAWqC,MAAMb,QAAU,OACnDzB,SAASC,eAAe,WAAWsC,YA3KzC","file":"../main.min.js","sourcesContent":["(function () {\r\n  // 项目配置.\r\n  // console.log(window.ellaBookH5IP + '/rest/api/service')\r\n\r\n  let api = window.ellaBookH5IP ? window.ellaBookH5IP + '/rest/api/service' : 'http://118.31.171.207:9000/rest/api/service';\r\n  let exchangeCode = \"\";\r\n  let thirdCode = \"\";\r\n  let thirdType = \"\";\r\n\r\n  /** \r\n   * @function initVipData\r\n   * @description 创建积分换会员dom\r\n   * @param {Array} totalList 总课表数组\r\n   * @returns {DOM} 用户模块和积分换会员模块页面信息\r\n   */\r\n  function initVipData(data) {\r\n    let result = '';\r\n    let members = \"\";\r\n    data.list.forEach((item, index) => {\r\n      members += `\r\n          <div class=\"memberItem\" data-params=${item.exchangeCode + ',' + item.thirdCode + ',' + item.thirdType} data-info=${item.activeTime + ',' + item.points + ',' + data.userInfo.pointsBalance}>\r\n          <div class=\"countsInfo\">\r\n            <p>${item.title}</p>\r\n            <p>原价：<span>${item.price}元</span></p>\r\n          </div>\r\n          <div class=\"counts\">${item.points} 积分</div>\r\n        </div>\r\n        `;\r\n    })\r\n\r\n\r\n    result += `\r\n        <div class=\"header\">\r\n\r\n        <img src=${!!data.userInfo.userAvatar ? data.userInfo.userAvatar : \"./imgs/defualtPho.png\"} />\r\n        <div class=\"headTxt\">\r\n          <p>${data.userInfo.userNick}</p>\r\n          <p>剩余会员：<span>${data.userInfo.vipLeftDays}天</span></p>\r\n        </div>\r\n      </div>\r\n      <div class=\"members\">\r\n        <p class=\"title\">积分换会员</p>\r\n        <div class=\"membersMain\">\r\n         ${members}\r\n        </div>\r\n\r\n      </div>`\r\n\r\n    return result;\r\n  }\r\n\r\n  /** \r\n   * @function checkEnvironment\r\n   * @description 检测设备类型\r\n   * @returns {string} iPhone|Android|other\r\n   */\r\n  function checkEnvironment() {\r\n    let isInApp, mobileType;\r\n    if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) {\r\n      if (!!window.webkit && !!window.webkit.messageHandlers && !!window.webkit.messageHandlers.showSharePop) {\r\n        isInApp = true;\r\n      }\r\n      mobileType = \"iPhone\";\r\n    } else if (/(Android)/i.test(navigator.userAgent)) {\r\n      if (!!window.WebView && !!window.WebView.showSharePop) {\r\n        isInApp = true;\r\n      }\r\n      mobileType = \"Android\";\r\n    } else {\r\n      isInApp = false;\r\n      mobileType = \"other\";\r\n    }\r\n\r\n    window.isInApp = isInApp;\r\n    window.mobileType = mobileType;\r\n    return {\r\n      isInApp: !!isInApp,\r\n      mobileType\r\n    }\r\n  }\r\n\r\n  /**\r\n   * @function init\r\n   * @description 主函数,根据服务端数据，创建页面\r\n   * @params {object} data 服务端返回的积分换会员数据\r\n   */\r\n  function init(data) {\r\n    /** 调用：创建页面方法 */\r\n\r\n    let doms = initVipData(data);\r\n    $(\".memberIntroduce\").before(doms)\r\n    /** 点击弹出积分换会员弹窗*/\r\n    $(\".memberItem\").on(\"click\", function () {\r\n      $(\".memberModal\").css({ display: \"block\" })\r\n      $(\".shade\").css({ display: \"block\" })\r\n      console.log($(this).data(\"info\"))\r\n      let arr = $(this).data(\"info\").split(\",\");\r\n\r\n      let activeTime = arr[0];\r\n      let points = arr[1];\r\n      let pointsBalance = arr[2];\r\n\r\n\r\n      $(\".lastPoint\").html(pointsBalance);\r\n      $(\".activeTime\").html(activeTime);\r\n      $(\".points\").html(points);\r\n      let arr2 = $(this).data(\"params\").split(\",\");\r\n      exchangeCode = arr2[0];\r\n      thirdCode = arr2[1];\r\n      thirdType = arr2[2];\r\n\r\n    })\r\n    /**关闭积分换会员弹窗 */\r\n    $(\".close\").on(\"click\", function () {\r\n      $(\".memberModal\").css({ display: \"none\" })\r\n      $(\".shade\").css({ display: \"none\" })\r\n    })\r\n    /**立即支付 */\r\n    $(\".save\").on(\"click\", function () {\r\n      $.post(api, {\r\n        method: 'ella.order.pointsExchange',\r\n        content: JSON.stringify({\r\n\r\n          // uid: \"U201801241526127604534\",\r\n          // uid: \"U201801200000128\",\r\n          exchangeCode,\r\n          thirdCode,\r\n          thirdType\r\n        }),\r\n        uid: ellaH5.getQuery('uid'),\r\n        channelCode: \"H5\",\r\n        token: \"guest\"\r\n      }, function (res) {\r\n        res = JSON.parse(res);\r\n        if (res.status === \"1\") {\r\n          $(\".j-pop\").css({ \"display\": \"block\" });\r\n          $(\".j-pop\").html(\"支付成功！\");\r\n          setTimeout(function () {\r\n            $(\".j-pop\").css({ \"display\": \"none\" });\r\n            location.reload(true);\r\n          }, 2000)\r\n        } else {\r\n          $(\".j-pop\").css({ \"display\": \"block\" });\r\n          $(\".j-pop\").html(res.message);\r\n          setTimeout(function () {\r\n            $(\".j-pop\").css({ \"display\": \"none\" });\r\n\r\n          }, 2000)\r\n        }\r\n      })\r\n    })\r\n\r\n  }\r\n  $.post(api, {\r\n    method: 'ella.user.listVipExchangeMenu',\r\n    content: JSON.stringify({\r\n      uid: ellaH5.getQuery('uid')\r\n      // uid: \"U201801241526127604534\",\r\n      // uid: \"U201801200000128\"\r\n    })\r\n\r\n  }, function (res) {\r\n    res = JSON.parse(res);\r\n    if (res.status === \"0\") {\r\n      window.ellaH5.alert(res.message, {\r\n        style: { color: '#fff' },\r\n        timeout: 1500\r\n      })\r\n    } else {\r\n      init(res.data);\r\n      document.getElementById('Loading').style.display = 'none';\r\n      document.getElementById('Loading').remove();\r\n    }\r\n  })\r\n\r\n})()"]}