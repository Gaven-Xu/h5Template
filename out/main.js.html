<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Source: main.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#checkEnvironment">checkEnvironment</a></li><li><a href="global.html#createWeeks">createWeeks</a></li><li><a href="global.html#init">init</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">Source: main.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>(function () {

  let { isInApp, mobileType } = checkEnvironment();

  // 项目配置.
  let api = window.ellaBookH5IP ? window.ellaBookH5IP + '/rest/api/service' : 'http://qaapi.ellabook.cn/rest/api/service';
  let downloadLink = 'https://a.app.qq.com/o/simple.jsp?pkgname=com.ellabook';
  let modalTitle = "订阅成功", modalContent = "感谢喜欢这本书，绘本上线当天会通知您来看哦！", modalNotice = "";
  if (!isInApp) {
    modalContent = "下载咿啦看书APP查看完整绘本书单";
    modalNotice = "新用户免费赠送绘本大礼包哦";
    document.querySelector('.weixin').style.display = 'block';
    document.querySelector('.weixin').onclick = function () {
      window.open(downloadLink);
    }
  }

  // 弹窗属性配置
  window.ellaH5.alertOptions = {
    id: 'AlertBox',
    style: {
      width: '70%',
      left: '10%',
      top: '35%',
      transform: 'translate(0,0)',
      webkitTransform: 'translate(0,0)',
      padding: '5%',
      backgroundColor: '#ffffff',
      borderRadius: '0.21rem'
    },
    maskStyle: {
      zIndex: 1000,
      backgroundColor: 'rgba(0,0,0,0.5)'
    },
    confirmText: "好的",
    confirmStyle: {
      display: 'block',
      width: '1.56rem',
      height: '.6rem',
      background: '#5baaf3',
      textAlign: 'center',
      lineHeight: '.6rem',
      borderRadius: '.32rem',
      margin: '.3rem auto 0',
      color: '#fff',
      fontSize: '.26rem'
    },
    closeStyle: {
      display: 'none'
    }
  }

  /** 
   * @function createWeeks
   * @description 创建周阅读数据DOM
   * @param {Array} totalList 总课表数组
   * @returns {DOM}
   */
  function createWeeks(totalList) {
    let result = '';
    let titles = [
      `&lt;span>放假啦~~让宝宝在假期开始时&lt;/span>
      &lt;span>放松身心，准备迎接美好的寒假生活&lt;/span>`,

      `&lt;span>马上就要过年啦~~我们又长大了一岁&lt;/span>
      &lt;span>多学些人文知识，在假期增长宝宝的眼界！&lt;/span>`,

      `&lt;span>过年啦~~大家春节快乐&lt;/span>
      &lt;span>带宝宝一起来了解中国传统的过年习俗吧&lt;/span>`,

      `&lt;span>假期接近尾声了，别难过&lt;/span>
      &lt;span>打开绘本，继续奇妙的梦幻之旅&lt;/span>`,

      `&lt;span>开学恐惧症？不怕&lt;/span>
      &lt;span>每天一部动画书，给你假期好心情&lt;/span>`
    ]
    for (let index = 0; index &lt; totalList.length; index++) {
      const weekData = totalList[index];

      let top = '';
      let content = '';
      let { winterVacationBooksDto: bookList } = weekData, normalBookList = bookList;

      /**
       * 区分最后一周
       * 如果不是最后一周，则是top(1)+content(6)的结构
       * 如果是最后一周，则是cotent(3)的结构
       */
      let book = bookList[0];
      top = `
            &lt;div class="top">
              &lt;div class="book-cover" style="background:#39b3f3 url(${book.bookCoverUrl}) center no-repeat;background-size:cover;">
                &lt;div class="hot">推荐&lt;/div>
              &lt;/div>
              &lt;div class="book-content">
                &lt;div class="book-name">《${book.bookName}》&lt;/div>
                &lt;div class="book-desc">${book.bookIntroduction}&lt;/div>
                &lt;div class="book-btn ${book.subscribeStatus === 'YES' ? 'checked' : ''}" data-code="${book.bookCode}">&lt;/div>
              &lt;/div>
            &lt;/div>
          `;
      normalBookList = normalBookList.slice(1);

      /** 创建图书列表 */
      normalBookList.forEach((book, index, bookLish) => {
        content += `
            &lt;div class="book" ${index === 3 ? 'style="clear:both"' : ''}>
              &lt;div class="cover" style="background:#39b3f3 url(${book.bookCoverUrl}) center no-repeat;background-size:cover;">
                &lt;div>
                  &lt;div class="book-btn ${book.subscribeStatus === 'YES' ? 'checked' : ''}" data-code="${book.bookCode}">&lt;/div>
                &lt;/div>
              &lt;/div>
              &lt;div class="name">${book.bookName}&lt;/div>
            &lt;/div>
          `;
      })

      /** 生成weeks代码串 */
      result += `
          &lt;div class="week week${index}">
              &lt;div class="tag">&lt;/div>
              &lt;div class="title">
                &lt;span>${weekData.planTitle.substr(5)}&lt;/span>
                ${titles[index]}
              &lt;/div>
              ${top}
              &lt;div class="divide">
                &lt;div class="left round">&lt;/div>
                &lt;div class="line">&lt;/div>
                &lt;div class="right round">&lt;/div>
              &lt;/div>
              &lt;div class="content">
                ${content}
              &lt;/div>
          &lt;/div>
        `;
    }
    return result;
  }

  /** 
   * @function checkEnvironment
   * @description 检测设备类型
   * @returns {string} iPhone|Android|other
   */
  function checkEnvironment() {
    let isInApp, mobileType;
    if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) {
      if (!!window.webkit &amp;&amp; !!window.webkit.messageHandlers &amp;&amp; !!window.webkit.messageHandlers.showSharePop) {
        isInApp = true;
      }
      mobileType = "iPhone";
    } else if (/(Android)/i.test(navigator.userAgent)) {
      if (!!window.WebView &amp;&amp; !!window.WebView.showSharePop) {
        isInApp = true;
      }
      mobileType = "Android";
    } else {
      isInApp = false;
      mobileType = "other";
    }

    window.isInApp = isInApp;
    window.mobileType = mobileType;
    return {
      isInApp: !!isInApp,
      mobileType
    }
  }

  /**
   * @function init
   * @description 主函数,根据服务端数据，创建页面
   * @params {object} data 服务端返回的课表数据
   */
  function init(data) {
    /** 调用：创建页面方法 */

    let doms = createWeeks(data);
    document.getElementById('Weeks').innerHTML = doms;
    /** 绑定点击事件 */
    let btns = document.querySelectorAll('.book-btn');

    try {
      for (var index = 0; index &lt; btns.length; index++) {
        var btn = btns[index];
        btn.onclick = function (e) {

          let that = this;

          let message = `
          &lt;div class="mail">&lt;/div>
          &lt;div>
          &lt;div class="title">${modalTitle}&lt;/div>
          &lt;div class="content">${modalContent}&lt;/div>
          &lt;div class="notice">${modalNotice}&lt;/div>
          &lt;/div>
          `;

          window.ellaH5.alert(message, {
            onConfirm: function () {
              if (isInApp) {
                $.post(api, {
                  method: 'ella.activity.subscribeBooks',
                  content: JSON.stringify({
                    uid: ellaH5.getQuery('uid'),
                    bookCode: that.dataset.code
                  })
                }, function (res) {
                  res = JSON.parse(res);
                  if (res.status !== "1") {
                    window.ellaH5.alert(res.message, {
                      style: { color: '#fff' },
                      timeout: 1500
                    })
                  }
                })

              } else {
                window.open(downloadLink)
              }
              /** 按钮状态 */
              if (!that.classList.contains('checked')) {
                that.classList.add('checked')
              }
            }
          });

        }
      }
    } catch (err) {
      alert(err)
    }

  }

  $.post(api, {
    method: 'ella.activity.getWinterVacationBooks',
    content: JSON.stringify({
      uid: ellaH5.getQuery('uid')
    })
  }, function (res) {
    res = JSON.parse(res);
    if (res.status === "0") {
      window.ellaH5.alert(res.message, {
        style: { color: '#fff' },
        timeout: 1500
      })
    } else {
      init(res.data);
      document.getElementById('Loading').style.display = 'none';
      document.getElementById('Loading').remove();
    }
  })

})()</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Mar 05 2019 17:33:41 GMT+0800 (中国标准时间) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
